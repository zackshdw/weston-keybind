name: CI

on:
  push:
  pull_request:

jobs:
  format-check:
    runs-on: ubuntu-latest
    container:
      image: debian:13
    steps:
      - uses: actions/checkout@v4
      - name: Install clang-format
        run: |
          apt-get update
          apt-get install -y clang-format-19
      - name: Verify clang-format Is Available
        run: |
          if ! command -v clang-format-19 >/dev/null 2>&1; then
            echo "clang-format Not Found After Install; Failing CI To Surface Tool Availability.";
            exit 1;
          fi
      - name: Run Format Check
        run: |
          make format || true

  build-and-test:
    runs-on: ubuntu-latest
    needs: format-check
    container:
      image: debian:13
    steps:
      - uses: actions/checkout@v4
      - name: Install build deps
        run: |
          apt-get update
          apt-get install -y build-essential pkg-config cmake clang-format-19 libevdev-dev libweston-14-dev libweston-14-0
      - name: Build And Run Tests
        run: |
          make
          make test
